<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Rotates the range `[mid-left, mid+right)` such that the element at `mid` becomes the first element. Equivalently, rotates the range `left` elements to the left or `right` elements to the right."><title>ptr_rotate in core::slice::rotate - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-2fcac8296ac587d8.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="core" data-themes="" data-resource-suffix="" data-rustdoc-version="1.72.0-nightly (b2b34bd83 2023-06-06)" data-search-js="search-4926e5fc22a5646a.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../../../static.files/storage-62ce34ea385b278a.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../static.files/main-48600a9606eff342.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"><script src="/stdrs_dev_script/nav.js"></script>
</head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../core/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../core/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><div class="sidebar-elems"><h2><a href="index.html">In core::slice::rotate</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="../../index.html">core</a>::<wbr><a href="../index.html">slice</a>::<wbr><a href="index.html">rotate</a>::<wbr><a class="fn" href="#">ptr_rotate</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/core/slice/rotate.rs.html#64-234">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub unsafe fn ptr_rotate&lt;T&gt;(left: <a class="primitive" href="../../primitive.usize.html">usize</a>, mid: <a class="primitive" href="../../primitive.pointer.html">*mut T</a>, right: <a class="primitive" href="../../primitive.usize.html">usize</a>)</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Rotates the range <code>[mid-left, mid+right)</code> such that the element at <code>mid</code> becomes the first
element. Equivalently, rotates the range <code>left</code> elements to the left or <code>right</code> elements to the
right.</p>
<h2 id="safety"><a href="#safety">Safety</a></h2>
<p>The specified range must be valid for reading and writing.</p>
<h2 id="algorithm"><a href="#algorithm">Algorithm</a></h2>
<p>Algorithm 1 is used for small values of <code>left + right</code> or for large <code>T</code>. The elements are moved
into their final positions one at a time starting at <code>mid - left</code> and advancing by <code>right</code> steps
modulo <code>left + right</code>, such that only one temporary is needed. Eventually, we arrive back at
<code>mid - left</code>. However, if <code>gcd(left + right, right)</code> is not 1, the above steps skipped over
elements. For example:</p>
<div class="example-wrap"><pre class="language-text"><code>left = 10, right = 6
the `^` indicates an element in its final place
6 7 8 9 10 11 12 13 14 15 . 0 1 2 3 4 5
after using one step of the above algorithm (The X will be overwritten at the end of the round,
and 12 is stored in a temporary):
X 7 8 9 10 11 6 13 14 15 . 0 1 2 3 4 5
              ^
after using another step (now 2 is in the temporary):
X 7 8 9 10 11 6 13 14 15 . 0 1 12 3 4 5
              ^                 ^
after the third step (the steps wrap around, and 8 is in the temporary):
X 7 2 9 10 11 6 13 14 15 . 0 1 12 3 4 5
    ^         ^                 ^
after 7 more steps, the round ends with the temporary 0 getting put in the X:
0 7 2 9 4 11 6 13 8 15 . 10 1 12 3 14 5
^   ^   ^    ^    ^       ^    ^    ^
</code></pre></div>
<p>Fortunately, the number of skipped over elements between finalized elements is always equal, so
we can just offset our starting position and do more rounds (the total number of rounds is the
<code>gcd(left + right, right)</code> value). The end result is that all elements are finalized once and
only once.</p>
<p>Algorithm 2 is used if <code>left + right</code> is large but <code>min(left, right)</code> is small enough to
fit onto a stack buffer. The <code>min(left, right)</code> elements are copied onto the buffer, <code>memmove</code>
is applied to the others, and the ones on the buffer are moved back into the hole on the
opposite side of where they originated.</p>
<p>Algorithms that can be vectorized outperform the above once <code>left + right</code> becomes large enough.
Algorithm 1 can be vectorized by chunking and performing many rounds at once, but there are too
few rounds on average until <code>left + right</code> is enormous, and the worst case of a single
round is always there. Instead, algorithm 3 utilizes repeated swapping of
<code>min(left, right)</code> elements until a smaller rotate problem is left.</p>
<div class="example-wrap"><pre class="language-text"><code>left = 11, right = 4
[4 5 6 7 8 9 10 11 12 13 14 . 0 1 2 3]
                 ^  ^  ^  ^   ^ ^ ^ ^ swapping the right most elements with elements to the left
[4 5 6 7 8 9 10 . 0 1 2 3] 11 12 13 14
       ^ ^ ^  ^   ^ ^ ^ ^ swapping these
[4 5 6 . 0 1 2 3] 7 8 9 10 11 12 13 14
we cannot swap any more, but a smaller rotation problem is left to solve
</code></pre></div>
<p>when <code>left &lt; right</code> the swapping happens from the left instead.</p>
</div></details></section></div></main></body></html>